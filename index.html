<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management Dashboard</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Login / Registration Section -->
    <section id="login-section" class="d-flex align-items-center justify-content-center vh-100 bg-light">
        <div class="card border-0 shadow-lg p-0 overflow-hidden"
            style="width: 100%; max-width: 450px; border-radius: 1rem;">

            <!-- Auth Tabs -->
            <div class="d-flex border-bottom">
                <div class="flex-fill text-center p-3 cursor-pointer fw-bold text-primary border-bottom border-3 border-primary active"
                    id="tab-login" style="cursor: pointer; background: #fff;">
                    <i class="fas fa-sign-in-alt me-2"></i> Login
                </div>
                <div class="flex-fill text-center p-3 cursor-pointer fw-bold text-secondary" id="tab-register"
                    style="cursor: pointer; background: #f9fafb;">
                    <i class="fas fa-user-plus me-2"></i> Register New Company
                </div>
            </div>

            <!-- Login Form Container -->
            <div class="p-4 bg-white" id="loginCustomForm">
                <div class="text-center mb-4">
                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                        style="width: 64px; height: 64px;">
                        <i class="fas fa-box-open fa-2x"></i>
                    </div>
                    <h4 class="fw-bold text-dark">Welcome Back</h4>
                    <p class="text-muted small">Sign in to manage your orders</p>
                </div>

                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-envelope text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0 bg-light" id="loginUser"
                                placeholder="name@company.com" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Password</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-lock text-muted"></i></span>
                            <input type="password" class="form-control border-start-0 ps-0 bg-light" id="loginPass"
                                placeholder="••••••••" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm" id="btnLogin">
                        Login
                    </button>
                </form>
                <div id="loginError" class="alert alert-danger py-2 small d-none text-center mt-3">Invalid Credentials
                </div>
            </div>

            <!-- Register Form Container -->
            <div class="p-4 bg-white d-none" id="registerCustomForm">
                <div class="text-center mb-4">
                    <h4 class="fw-bold text-dark">Create Account</h4>
                    <p class="text-muted small">Start managing your business today</p>
                </div>

                <form id="registerForm">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Company Name</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-building text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0 bg-light" id="regName"
                                placeholder="My Logistics Co." required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-envelope text-muted"></i></span>
                            <input type="email" class="form-control border-start-0 ps-0 bg-light" id="regEmail"
                                placeholder="admin@company.com" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Password</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-lock text-muted"></i></span>
                            <input type="password" class="form-control border-start-0 ps-0 bg-light" id="regPass"
                                placeholder="Create a strong password" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success w-100 py-2 fw-bold shadow-sm" id="btnRegister">
                        Register Company
                    </button>
                </form>
            </div>

        </div>
    </section>

    <!-- Main App Wrapper -->
    <div id="app-container" class="d-none">

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="brand" id="sidebarBrand">
                <i class="fas fa-box-open"></i> OMS Live v2
            </div>
            <div class="nav flex-column">
                <a href="#" class="nav-link active" data-target="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-target="booking">
                    <i class="fas fa-plus-circle"></i> New Booking
                </a>
                <a href="#" class="nav-link" data-target="orders">
                    <i class="fas fa-shopping-cart"></i> Orders
                </a>
                <a href="#" class="nav-link" data-target="products">
                    <i class="fas fa-box"></i> Products
                </a>
                <a href="#" class="nav-link" data-target="expenses">
                    <i class="fas fa-wallet"></i> Expenses
                </a>
                <a href="#" class="nav-link" data-target="reports">
                    <i class="fas fa-chart-line"></i> Reports
                </a>
                <a href="#" class="nav-link" data-target="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>

                <hr class="text-secondary opacity-25 my-2">

                <a href="#" class="nav-link" id="darkModeToggle">
                    <i class="fas fa-moon"></i> Dark Mode
                </a>

                <a href="#" class="nav-link text-danger mt-auto" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section">
                <h2 class="mb-4">Dashboard Overview</h2>

                <!-- Row 1: Order Counts -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-primary bg-opacity-10 text-primary rounded p-3 me-3">
                                    <i class="fas fa-calendar-day fa-lg"></i>
                                </div>
                                <div>
                                    <h3 class="stat-value fw-bold mb-0" id="kpi-today">0</h3>
                                    <p class="stat-label text-muted mb-0">Today's Orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-warning bg-opacity-10 text-warning rounded p-3 me-3">
                                    <i class="fas fa-clock fa-lg"></i>
                                </div>
                                <div>
                                    <h3 class="stat-value fw-bold mb-0" id="kpi-pending">0</h3>
                                    <p class="stat-label text-muted mb-0">Pending Orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-success bg-opacity-10 text-success rounded p-3 me-3">
                                    <i class="fas fa-check-circle fa-lg"></i>
                                </div>
                                <div>
                                    <h3 class="stat-value fw-bold mb-0" id="kpi-delivered">0</h3>
                                    <p class="stat-label text-muted mb-0">Delivered Orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm">
                            <div class="d-flex align-items-center">
                                <div class="stat-icon bg-danger bg-opacity-10 text-danger rounded p-3 me-3">
                                    <i class="fas fa-undo fa-lg"></i>
                                </div>
                                <div>
                                    <h3 class="stat-value fw-bold mb-0" id="kpi-returned">0</h3>
                                    <p class="stat-label text-muted mb-0">Returned Orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 2: Financial Amounts (Bordered) -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm border-start border-4 border-info">
                            <p class="stat-label text-muted mb-1">Total COD Amount</p>
                            <h3 class="stat-value fw-bold text-info mb-0" id="kpi-cod-amount">Rs. 0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm border-start border-4 border-success">
                            <p class="stat-label text-muted mb-1">Delivered Amount</p>
                            <h3 class="stat-value fw-bold text-success mb-0" id="kpi-delivered-amount">Rs. 0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm border-start border-4 border-warning">
                            <p class="stat-label text-muted mb-1">Pending Amount</p>
                            <h3 class="stat-value fw-bold text-warning mb-0" id="kpi-pending-amount">Rs. 0</h3>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card bg-white p-3 rounded shadow-sm border-start border-4 border-danger">
                            <p class="stat-label text-muted mb-1">Returned Amount</p>
                            <h3 class="stat-value fw-bold text-danger mb-0" id="kpi-returned-amount">Rs. 0</h3>
                        </div>
                    </div>
                </div>

                <!-- Row 3: Expenses & Profit -->
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="stat-card bg-white p-4 rounded shadow-sm border border-danger border-opacity-25">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-secondary mb-1">Total Expenses</p>
                                    <h2 class="text-danger fw-bold mb-0">Rs. <span id="kpi-expenses">0</span></h2>
                                </div>
                                <i class="fas fa-wallet fa-3x text-danger opacity-25"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card bg-white p-4 rounded shadow-sm border border-success border-opacity-25">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-secondary mb-1">Net Profit / Loss</p>
                                    <h2 class="text-success fw-bold mb-0" id="kpi-profit-container">
                                        Rs. <span id="kpi-profit">0</span>
                                    </h2>
                                </div>
                                <i class="fas fa-chart-line fa-3x text-success opacity-25"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row 4: Charts -->
                <div class="row g-4">
                    <div class="col-md-8">
                        <div class="card h-100 border-0 shadow-sm p-3">
                            <h5 class="card-title mb-3">Orders by Status</h5>
                            <div style="height: 300px; display: flex; justify-content: center;">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 border-0 shadow-sm p-3">
                            <h5 class="card-title mb-3">Courier Performance</h5>
                            <div style="height: 300px;">
                                <canvas id="courierChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- New Booking Section -->
            <section id="booking" class="content-section d-none">
                <h2 class="mb-4">New Booking</h2>
                <div class="card border-0 shadow-sm p-4">
                    <form id="bookingForm">
                        <div class="row g-3">
                            <!-- Reseller Select -->
                            <div class="col-md-6">
                                <label class="form-label">Reseller</label>
                                <select class="form-select" name="resellerName" id="resellerSelect" required>
                                    <option value="">Loading...</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Customer Name</label>
                                <input type="text" class="form-control" name="customerName" required>
                            </div>

                            <!-- Dynamic Phone Numbers -->
                            <div class="col-md-6">
                                <label class="form-label">Phone</label>
                                <div id="phoneParam">
                                    <div class="input-group">
                                        <input type="tel" class="form-control" name="phone[]" placeholder="03001234567"
                                            required>
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="addPhoneField()">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" name="address" rows="2" required></textarea>
                            </div>

                            <!-- Product w/ Dropdown -->
                            <div class="col-md-6">
                                <label class="form-label">Product</label>
                                <select class="form-select" name="productName" id="productSelect"
                                    onchange="App.onProductSelect(this)" required>
                                    <option value="">Select Product</option>
                                </select>
                            </div>

                            <div class="col-md-3">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-control" name="quantity" value="1" min="1" required>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Total Amount (COD)</label>
                                <input type="number" class="form-control" name="amount" required>
                                <small class="text-muted">Enter Manual Amount</small>
                            </div>

                            <!-- Courier Select -->
                            <div class="col-md-6">
                                <label class="form-label">Courier Service</label>
                                <select class="form-select" name="courier" id="courierSelect" required>
                                    <option value="">Select Courier</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Tracking Number (Optional)</label>
                                <input type="text" class="form-control" name="trackingNumber">
                            </div>

                            <div class="col-12 mt-4">
                                <button type="submit" class="btn btn-primary px-5">
                                    <span class="spinner-border spinner-border-sm d-none me-2"></span>
                                    Save Booking
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="content-section d-none">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Orders List</h2>
                    <div>
                        <button class="btn btn-outline-primary me-2" onclick="Print.printOrders()">
                            <i class="fas fa-print"></i> Print Slips
                        </button>
                        <button class="btn btn-outline-success" onclick="Reports.exportCSV()">
                            <i class="fas fa-file-csv"></i> Export CSV
                        </button>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle mb-0" id="ordersTable">
                                <thead class="bg-light">
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Date</th>
                                        <th>Customer</th>
                                        <th>Amount</th>
                                        <th>Courier</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTableBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div class="p-3 d-flex justify-content-end">
                            <nav>
                                <ul class="pagination mb-0" id="pagination"></ul>
                            </nav>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section id="products" class="content-section d-none">
                <h2 class="mb-4">Product Management</h2>
                <div class="row g-4">
                    <!-- Add Product Content -->
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Add Product</h5>
                                <form id="addProductForm">
                                    <div class="mb-3">
                                        <label class="form-label">Name</label>
                                        <input type="text" class="form-control" id="newProductName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Size/Variant</label>
                                        <input type="text" class="form-control" id="newProductSize">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Price</label>
                                        <input type="number" class="form-control" id="newProductPrice" required>
                                    </div>
                                    <button type="submit" class="btn btn-success w-100">Add Product</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- Product Table -->
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-0">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th>Product</th>
                                            <th>Size</th>
                                            <th>Price</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsTableBody">
                                        <!-- JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Expenses Section -->
            <section id="expenses" class="content-section d-none">
                <h2 class="mb-4">Expense Tracker</h2>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title mb-3">New Expense</h5>
                                <form id="addExpenseForm">
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" id="expenseDesc" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Amount</label>
                                        <input type="number" class="form-control" id="expenseAmount" required>
                                    </div>
                                    <button type="submit" class="btn btn-danger w-100">Add Expense</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body p-0">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Description</th>
                                            <th>Amount</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="expensesTableBody">
                                        <!-- JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section d-none">
                <h2 class="mb-4">Advanced Reports</h2>
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <label class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="reportStart">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">End Date</label>
                                <input type="date" class="form-control" id="reportEnd">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="reportStatus">
                                    <option value="">All Statuses</option>
                                    <!-- Populated via JS if needed, or hardcoded options -->
                                    <option value="Delivered">Delivered</option>
                                    <option value="Returned">Returned</option>
                                </select>
                            </div>
                            <div class="col-md-3 d-flex align-items-end">
                                <button class="btn btn-primary w-100" onclick="Reports.generate()">
                                    Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th>Order ID</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Status</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody id="reportsTableBody">
                                <!-- JS -->
                            </tbody>
                            <tfoot class="bg-light fw-bold">
                                <tr id="reportSummary">
                                    <td colspan="5" class="text-center">Select dates to generate report</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section d-none">
                <!-- JS injects here usually, but let's provide a container -->
            </section>

        </main>
    </div>

    <!-- Hidden Print Area -->
    <div id="print-area" class="d-none"></div>

    <!-- Script Imports (FLATTENED & VERSIONED) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="config.js?v=4"></script>
    <script src="api.js?v=4"></script>
    <script src="auth.js?v=4"></script>

    <!-- Modules -->
    <script src="settings.js?v=4"></script>
    <script src="expenses.js?v=4"></script>
    <script src="products.js?v=4"></script>
    <script src="orders.js?v=4"></script>
    <script src="reports.js?v=4"></script>
    <script src="dashboard.js?v=4"></script>
    <script src="print.js?v=4"></script>

    <!-- Main -->
    <script src="app.js?v=4"></script>
</body>

</html>