<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Management Dashboard</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- DEBUG ERROR HANDLER -->
    <script>
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            alert("Error: " + msg + "\nLine: " + lineNo + "\nFile: " + url);
            return false;
        };
    </script>
</head>

<body>

    <!-- Login Section -->
    <!-- Login / Registration Section -->
    <section id="login-section" class="d-flex align-items-center justify-content-center vh-100 bg-light">
        <div class="card border-0 shadow-lg p-0 overflow-hidden"
            style="width: 100%; max-width: 450px; border-radius: 1rem;">

            <!-- Auth Tabs -->
            <div class="d-flex border-bottom">
                <div class="flex-fill text-center p-3 cursor-pointer fw-bold text-primary border-bottom border-3 border-primary active"
                    id="tab-login" style="cursor: pointer; background: #fff;">
                    <i class="fas fa-sign-in-alt me-2"></i> Login
                </div>
                <div class="flex-fill text-center p-3 cursor-pointer fw-bold text-secondary" id="tab-register"
                    style="cursor: pointer; background: #f9fafb;">
                    <i class="fas fa-user-plus me-2"></i> Register New Company
                </div>
            </div>

            <!-- Login Form Container -->
            <div class="p-4 bg-white" id="loginCustomForm">
                <div class="text-center mb-4">
                    <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                        style="width: 64px; height: 64px;">
                        <i class="fas fa-box-open fa-2x"></i>
                    </div>
                    <h4 class="fw-bold text-dark">Welcome Back</h4>
                    <p class="text-muted small">Sign in to manage your orders</p>
                </div>

                <form id="loginForm">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-envelope text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0 bg-light" id="loginUser"
                                placeholder="name@company.com" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Password</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-lock text-muted"></i></span>
                            <input type="password" class="form-control border-start-0 ps-0 bg-light" id="loginPass"
                                placeholder="••••••••" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold shadow-sm" id="btnLogin">
                        Login
                    </button>
                </form>
                <div id="loginError" class="alert alert-danger py-2 small d-none text-center mt-3">Invalid Credentials
                </div>
            </div>

            <!-- Register Form Container -->
            <div class="p-4 bg-white d-none" id="registerCustomForm">
                <div class="text-center mb-4">
                    <h4 class="fw-bold text-dark">Create Account</h4>
                    <p class="text-muted small">Start managing your business today</p>
                </div>

                <form id="registerForm">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Company Name</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-building text-muted"></i></span>
                            <input type="text" class="form-control border-start-0 ps-0 bg-light" id="regName"
                                placeholder="My Logistics Co." required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Email Address</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-envelope text-muted"></i></span>
                            <input type="email" class="form-control border-start-0 ps-0 bg-light" id="regEmail"
                                placeholder="admin@company.com" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-uppercase text-secondary">Password</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-end-0"><i
                                    class="fas fa-lock text-muted"></i></span>
                            <input type="password" class="form-control border-start-0 ps-0 bg-light" id="regPass"
                                placeholder="Create a strong password" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success w-100 py-2 fw-bold shadow-sm" id="btnRegister">
                        Register Company
                    </button>
                </form>
            </div>

        </div>
    </section>

    <!-- Main App Wrapper -->
    <div id="app-container" class="d-none">

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="brand" id="sidebarBrand">
                <i class="fas fa-box-open"></i> OMS Panel
            </div>
            <div class="nav flex-column">
                <a href="#" class="nav-link active" data-target="dashboard">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="#" class="nav-link" data-target="booking">
                    <i class="fas fa-plus-circle"></i> New Booking
                </a>
                <a href="#" class="nav-link" data-target="orders">
                    <i class="fas fa-shopping-cart"></i> Orders
                </a>
                <a href="#" class="nav-link" data-target="products">
                    <i class="fas fa-box"></i> Products
                </a>
                <a href="#" class="nav-link" data-target="expenses">
                    <i class="fas fa-wallet"></i> Expenses
                </a>
                <a href="#" class="nav-link" data-target="reports">
                    <i class="fas fa-chart-line"></i> Reports
                </a>
                <a href="#" class="nav-link" data-target="settings">
                    <i class="fas fa-cog"></i> Settings
                </a>

                <hr class="text-secondary opacity-25 my-2">

                <a href="#" class="nav-link" id="darkModeToggle">
                    <i class="fas fa-moon"></i> Dark Mode
                </a>

                <a href="#" class="nav-link text-danger mt-auto" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section">
                <h2 class="mb-4">Dashboard Overview</h2>

                <!-- KPI Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon bg-soft-primary text-primary">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <h3 class="stat-value" id="kpi-today">0</h3>
                            <p class="stat-label">Today's Orders</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon badge-soft-warning">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h3 class="stat-value" id="kpi-pending">0</h3>
                            <p class="stat-label">Pending Orders</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon badge-soft-success">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h3 class="stat-value" id="kpi-delivered">0</h3>
                            <p class="stat-label">Delivered Orders</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-icon badge-soft-danger">
                                <i class="fas fa-undo"></i>
                            </div>
                            <h3 class="stat-value" id="kpi-returned">0</h3>
                            <p class="stat-label">Returned Orders</p>
                        </div>
                    </div>
                </div>

                <!-- Financial Overview -->
                <div class="row g-4 mb-4">
                    <!-- Total COD -->
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card border-info border-3">
                            <div class="stat-label">Total COD Amount</div>
                            <div class="stat-value text-info" id="kpi-cod-amount">Rs. 0</div>
                        </div>
                    </div>
                    <!-- Delivered -->
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card border-success border-3">
                            <div class="stat-label">Delivered Amount</div>
                            <div class="stat-value text-success" id="kpi-delivered-amount">Rs. 0</div>
                        </div>
                    </div>
                    <!-- Pending -->
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card border-warning border-3">
                            <div class="stat-label">Pending Amount</div>
                            <div class="stat-value text-warning" id="kpi-pending-amount">Rs. 0</div>
                        </div>
                    </div>
                    <!-- Returned -->
                    <div class="col-md-6 col-lg-3">
                        <div class="stat-card border-danger border-3">
                            <div class="stat-label">Returned Amount</div>
                            <div class="stat-value text-danger" id="kpi-returned-amount">Rs. 0</div>
                        </div>
                    </div>
                </div>

                <!-- Profit & Loss Row -->
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="stat-card border-start border-4 border-danger">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="stat-label">Total Expenses</p>
                                    <h3 class="stat-value text-danger">Rs. <span id="kpi-expenses">0</span></h3>
                                </div>
                                <i class="fas fa-wallet text-danger opacity-25 fa-2x"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stat-card border-start border-4 border-success">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="stat-label">Net Profit / Loss</p>
                                    <h3 class="stat-value text-success" id="kpi-profit-container">
                                        Rs. <span id="kpi-profit">0</span>
                                    </h3>
                                </div>
                                <i class="fas fa-chart-line text-success opacity-25 fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row g-4">
                    <div class="col-md-8">
                        <div class="card h-100 shadow-sm border-0">
                            <div class="card-body">
                                <h5 class="card-title">Orders by Status</h5>
                                <div class="chart-container-wrapper">
                                    <canvas id="statusChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm border-0">
                            <div class="card-body">
                                <h5 class="card-title">Courier Performance</h5>
                                <div class="chart-container-wrapper">
                                    <canvas id="courierChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- New Booking Section -->
            <section id="booking" class="content-section d-none">
                <h2 class="mb-4">New Booking</h2>
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-4">
                        <form id="bookingForm">
                            <!-- Customer Info -->
                            <div class="mb-4">
                                <h5 class="form-section-title">Customer Information</h5>
                                <div class="row g-3">
                                    <div class="col-12">
                                        <label class="form-label">Reseller *</label>
                                        <select class="form-select" name="resellerName" id="resellerSelect" required>
                                            <option value="">Select Reseller</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Customer Name *</label>
                                        <input type="text" class="form-control" name="customerName" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Phone Number *</label>
                                        <div id="phoneParam" class="d-flex flex-column gap-2">
                                            <div class="input-group">
                                                <input type="tel" class="form-control" name="phone[]"
                                                    placeholder="03001234567" required>
                                                <button type="button" class="btn btn-outline-secondary"
                                                    onclick="addPhoneField()">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Complete Address *</label>
                                        <textarea class="form-control" name="address" rows="2" required></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Product Info -->
                            <div class="mb-4">
                                <h5 class="form-section-title">Product Details</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Product Name</label>
                                        <select class="form-select" name="productName" id="productSelect"
                                            onchange="App.onProductSelect(this)">
                                            <option value="">Select Product</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Quantity</label>
                                        <input type="number" class="form-control" name="quantity" value="1" min="1">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Cash Amount (Rs.) *</label>
                                        <input type="number" class="form-control" name="amount" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Shipping Info -->
                            <div class="mb-4">
                                <h5 class="form-section-title">Shipping Details</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Courier Service</label>
                                        <select class="form-select" name="courier" id="courierSelect">
                                            <!-- Populated by JS -->
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Tracking Number (Optional)</label>
                                        <input type="text" class="form-control" name="trackingNumber">
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex justify-content-end gap-2">
                                <button type="reset" class="btn btn-light">Reset</button>
                                <button type="submit" class="btn btn-primary px-4">
                                    <span class="spinner-border spinner-border-sm d-none me-2" role="status"
                                        aria-hidden="true"></span>
                                    Save Booking
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="content-section d-none">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Orders Management</h2>
                    <div class="d-flex gap-2">
                        <input type="text" class="form-control" placeholder="Search orders..." style="width: 250px;">
                        <button class="btn btn-outline-primary"><i class="fas fa-filter"></i></button>
                    </div>
                </div>

                <div class="table-container">
                    <table class="table table-hover" id="ordersTable">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Courier</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Populated by JS -->
                            <tr>
                                <td colspan="7" class="text-center py-4">Loading orders...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Products Section -->
            <section id="products" class="content-section d-none">
                <h2 class="mb-4">Product Management</h2>

                <!-- Add Product -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Add New Product</h5>
                        <form id="addProductForm" class="row g-3 align-items-end">
                            <div class="col-md-5">
                                <label class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="newProductName" required
                                    placeholder="e.g. Smart Watch">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Size/Packing</label>
                                <input type="text" class="form-control" id="newProductSize"
                                    placeholder="e.g. 10ml, Large">
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Price (Rs.)</label>
                                <input type="number" class="form-control" id="newProductPrice" required
                                    placeholder="e.g. 1500">
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-success w-100">Add</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Product List -->
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="table-container p-0 shadow-none">
                            <table class="table table-hover" id="productsTable">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Product Name</th>
                                        <th>Size</th>
                                        <th>Price</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Expenses Section -->
            <section id="expenses" class="content-section d-none">
                <h2 class="mb-4">Expense Management</h2>

                <div class="row">
                    <!-- Add Form -->
                    <div class="col-md-4">
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-body">
                                <h5 class="card-title mb-3">Add Expense</h5>
                                <form id="addExpenseForm">
                                    <div class="mb-3">
                                        <label class="form-label">Description</label>
                                        <input type="text" class="form-control" id="expenseDesc" required
                                            placeholder="e.g. Packaging Material">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Amount (Rs.)</label>
                                        <input type="number" class="form-control" id="expenseAmount" required
                                            placeholder="0.00">
                                    </div>
                                    <button type="submit" class="btn btn-danger w-100">
                                        <i class="fas fa-minus-circle"></i> Add Expense
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- List -->
                    <div class="col-md-8">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">Recent Expenses</h5>
                                <div class="table-container p-0 shadow-none">
                                    <table class="table table-hover" id="expensesTable">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Description</th>
                                                <th>Amount</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <!-- JS -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="content-section d-none">
                <h2 class="mb-4">Reports</h2>
                <div class="alert alert-info">Reports module coming soon...</div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="content-section d-none">
                <h2 class="mb-4">Master Settings</h2>
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-4">
                    <li class="nav-item">
                        <a class="nav-link active" data-bs-toggle="tab" href="#profile-settings">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="tab" href="#api-settings">API Config</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane fade show active" id="profile-settings">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5>Business Information</h5>
                                <form>
                                    <div class="mb-3">
                                        <label>Business Name</label>
                                        <input type="text" class="form-control" value="My Store">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="api-settings">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body">
                                <h5>API Connections</h5>
                                <div class="mb-3">
                                    <label>Google Apps Script URL</label>
                                    <input type="text" class="form-control" readonly
                                        value="https://script.google.com/macros/s/...">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>

        <!-- Hidden Print Area -->
        <div id="print-area" class="d-none"></div>

        <!-- VISUAL DEBUG STATUS -->
        <div id="sys-status"
            style="position:fixed; bottom:0; left:0; width:100%; background:red; color:white; text-align:center; padding:5px; z-index:9999;">
            System Status: Waiting for JS... (If this stays Red, JS is broken)
        </div>
    </div> <!-- End App Container -->

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>

    <!-- Modules -->
    <script src="js/settings.js"></script>
    <script src="js/expenses.js"></script>
    <script src="js/products.js"></script>
    <script src="js/orders.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/print.js"></script>

    <!-- Main -->
    <script src="js/app.js"></script>
</body>

</html>